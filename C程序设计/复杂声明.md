# 复杂声明

本文是C的复杂声明的总结。

## 常见

- `()` `.` `->` `[]` 运算符优先级为一级(最高), 其中 `()` > `[]`
- `*` `++` `&` 优先级为二级, 所以`++p_rule->len` 和 `++rule.len` 都是将 `len` 的长度自增, `*p->str++` 则是将str指向处的值++
- 声明时`*` 表示一个指针，`()`表示一个函数,`[]`表示一个数组
- `int p`  这是一个普通的整形变量
- `int *p` 这是一个指针，指针指向的内容为整型数据
- `int p[3]`   这是一个普通的数组，有3个元素，每个元素的数据都是整型
- `int *p[3]`  p先于`[]`结合，说明这是一个数组，里面有3个元素，再与`*`结合，说明每个元素的类型都是指针，再与`int`结合，说明每个指针都指向`int`型
- `int (*p)[3]` p先和`*`结合，说明是一个指针，然后与`[]`结合，指针指向的内容是一个数组，该数组有3个元素，再与int结合，说明每个元素都是int型
- `int **p` 一个普通的二级指针
- `int p[8][8]` 声明一个内含int数组的数组
- `int *oof[3][4]` 声明一个3x4的二维数组，每个元素都是指向int的指针
- `int (*uuf)[3][4]` 声明一个指向3x4二维数组的指针
- `int (*uof[3])[4]` 申明一个内含３个指针元素的数组，每个指针指向内含4个int类型元素的数组
- `int p(int)`  一个普通的函数p，返回值为int型，函数参数为int型
- `int (*p)(int)` `*p`是一个指针，再与`()`结合，说明指针指向一个函数,该函数参数为int型，再结合最左边的int，函数的返回值也是int型

## `int (* func)(int * p)`

- 首先找到变量名`func`，外面有一对圆括号，而且左边是一个`*`号，这说明func是一个指针
- 然后跳出这个圆括号，先看右边，又遇到圆括号，这说明`(*func)`是一个函数,所以`func`是一个指向这类函数的指针，即函数指针
- 这类函数具有`int*`类型的形参，返回值类型是`int`

## `int ( * func[5])( int * )`

- `func`右边是一个`[]`运算符，说明`func`是具有5个元素的数组；
- `func`的左边有一个`*`，说明`func`的元素是指针
- 跳出这个括号，看右边，又遇到圆括号，说明`func`数组的元素是函数类型的指针，它指向的函数具有`int *` 类型的形参，返回值类型为`int`

## `char (*(*X())[])()`

- 首先，`()`的优先级高于`*`,所以`X`先结合`()`,先确定`X`是一个函数
- 函数`X()`前面的部分就是返回值,`* X()`理解为 : 函数的返回值为指针
- 现在假设该指针为 `P`, 则声明转化为: `char (*(*P)[])() X()`
- 现在需要理解的就是 `char (*(*P)[])()` 是怎样的一个指针了
- 假设 `Y` 为 `(*(*P)[])`, 则 `char Y()`, 可以知道 `Y`为一个函数，返回值为 `char` 类型
- 假设 `Z` 为 `(*P)[]` , 则 `*Z`， 说明 `Z` 是一个指针
- 假设 `H` 为 `(*P)`, `H[]`, 说明 `H` 是一个指针
- 所以，综上，对指针`P`取值后(解引用)`*P`为指针`H`,`H`解引用`H[]`后为指针`Z`, `Z`解引用后`*Z`为函数`Y`
- 总结： X是个返回值为指针的函数，该指针解引用三次后是一个 无参数，返回值为char 的函数

## `void (*b[10])(void(*)())`

- 变量名为b,`b[10]` 说明 `b` 为一个数组,元素个数为 10
- `*b[10]` 说明 数组里的每个元素都是一个指针
- `void (*b[10])(...)`,说明该指针为一个函数指针，该函数的返回值为`void`,入参为`void(*)()`
- `void(*)()` 首先,没有变量名，但是它等价于`void (* pfunc)()` , 即 一个没有入参，也没有出参的 函数指针

```c
// 先简化(void( * )())
typedef void (* pFunParam)();
// 然后再简化原声明
typedef void (* pFunx)(pFunParam);
// 下列声明等价原声明
pFunx b[10];
```

## `double (*)()(*e)[9]`

```c
// 别名一
typedef double (*pFuny)();
// 别名二
typedef pFuny (*pFunParamy)[9];
// 等价原声明
pFunParamy e;
```

- 为复杂的声明定义一个新的简单的别名
- 复杂声明查看原则 : 从变量名看起，先往右，再往左，碰到一个圆括号就调转阅读的方向；括号内分析完就跳出括号，还是按先右后左的顺序，如此循环，直到整个声明分析完