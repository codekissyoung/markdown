# 内存操作

## 结构体成员指针未初始化

```c
struct student  
{  
    char *name;  
    int score;  
} stu , *pstu;

int main()  
{  
    strcpy(stu.name,"Jimy");  
    stu.score = 99;  
    return 0;  
}  
```

解决的办法是为 `name` 指针`malloc`一块空间

```c
int main()  
{  
    pstu = (struct student*)malloc(sizeof(struct student));  
    strcpy(pstu->name,"Jimy");  
    pstu->score = 99;  
    free(pstu);  
    return 0;  
}
```


## 申请内存

```c
// 返回值：分配成功返回分配内存块的首地址，失败返回NULL
void *malloc( size_t size );

// num为分配内存块的个数，size为分配内存块的大小
void *calloc( int num, size_t size );
```

- 区别
  - malloc一次只能申请一个内存区，calloc一次可以申请多个内存区；
  - malloc不会对分配的内存初始化，calloc会初始化为0

## 释放申请到的内存

```c
// ptr为malloc或calloc等内存分配函数返回的内存指针
void free(void *ptr);
```

## 拷贝内存内容

```c
// dest为目标内存区，src为源内存区，n为需要拷贝的字节数
// 返回值: 指向dest的指针
// 缺点: 未考虑内存重叠情况
void *memcpy(void *dest, void *src, size_t n);

// 相比memcpy：当dest与src重叠时，仍能正确处理，但是src内容会被改变
// 当dest与src重叠时，仍能正确处理，但是src内容会被改变 推荐使用
void *memmove(void *dest, void *src, size_t n);

// 函数实现
void *memmove(void *dest, void *src, size_t n)
{
    char *ret = char *dest;
    char *dest_t;
    char *src_t;
    if((unsigned char *dest <= unsigned char *src) || (unsigned char *dest >= unsigned char *src + n))
    {
        dest_t = char *dest;
        src_t = char *src;
        while(n--)
        {
            *dest_t++ = *src_t++; //正向拷贝
        }
    }
    else
    {
        dest_t = char *dest + n - 1;
        src_t = char *src + n - 1;
        while(n--)
        {
            *dest_t-- = *src_t--; //反向拷贝
        }
    }
    return ret;
}
```

## 初始化指定内存空间

```c
// memset是按字节为单位对buffer指向的内存赋值
void *memset(void *buffer, int c, size_t n);

int a[5];

// 00000011 00000011 00000011 00000011
memset(a, 3, 5 * sizeof(int) );

// 00000000 00000000 00000000 00000000
memset(a, 0, 5 * sizeof(int));
```

## 比较两个内存空间的字符

```c
// n为要比较的字符数
int memcmp(const void *buf1, const void *buf2, size_t n);
- 返回值
  - 当buf1 > buf2时，返回 > 0
  - 当buf1 = buf2时，返回 = 0
  - 当buf1 < buf2时，返回 < 0
```

## 在内存中查找字符

```c
// 返回指向ptr指向的内存块中value值第一次出现位置的指针,如果没有找到value值，则该函数返回NULL
const void * memchr ( const void * ptr, int value, size_t num );

// 举例
char *pch;
char str[] = "Example string";
pch = (char*)memchr (str, 'p', strlen(str));
```
