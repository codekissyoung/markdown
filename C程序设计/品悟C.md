# 《品悟C 抛弃C程序设计中谬误与恶习》

本文是《品悟C 抛弃C程序设计中谬误与恶习》的学习笔记。

## 第1章 低级错误

### C与C++是两种语言

最好将`C`与`C++`看成两种语言，虽然`C++`编译器可以编译`C`代码。

```c
int a;
(a = 3 * 5) = 4 * 3;
```

上述代码在`gcc`编译器下报错:

```bash
➜  algorithm git:(master) ✗ gcc main.c -o main
main.c: In function ‘main’:
main.c:12:17: error: lvalue required as left operand of assignment
     (a = 3 * 5) = 4 * 3;
                 ^
```

而在`g++`编译器下可以编译执行，原因是`C++`语言中，赋值表达式是左值。

### 编译流程错误

编译错误: 是因为代码本身不符合C语言的规范。

链接错误: 是由于在链接时找不到期待的外部对象。

逻辑错误: 运行后程序不符合预期。

### 宏后面加分号

```c
#define ABC 123;

do
    a += ABC;
while( ++i < 2 );
```

上述代码由于`a += ABC;`展开后`a += 123;;`　直接导致`while()`不能执行。

### C语言要求switch中case后面只能是整数常量

## 初级错误

### 随手写出的大数

```c
printf("%d\n", 30000000000); // 整数溢出了

printf("123456 * 654321 = %d\n", 123456 * 654321 ); // 整数溢出了

double a = 12345678954321;  // 编译器自动转换
printf("%f\t%e\t%g\n",a,a,a);

double a = 12345678954321.0; // 推荐写法，不依赖编译器自动转换
```

### 对数组的误用与误解

试图输出整个数组:

```c
int a[8] = {1,2,34,45,6,7,7,9};
printf("%d", a[8]);
```

试图用数组名表示整个数组:

```c
printf("%d", a); // 实际上输出了 a[0] 的值
```

`a`数组名其实代表了整个数组，`sizeof(a)`求出来的值也是整个数组的大小，但是当数组名作为参数时，它会被强制转换为第一个元素的指针类型。

试图对整个数组赋值:

```c
int b[8];
b = a;
```

## 逻辑错误

### 幼稚的写法

```c
int a[10];
for( int i = 0; i < 10; i++ )
    scanf( "%d", &a[i] );
```

修改为:

```c
scanf("%d", a+i);
```
