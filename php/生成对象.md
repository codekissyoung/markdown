# Single 单例模式
- 该对象可以被系统中任何对象使用
- 该对象不会存储在全局变量中
- 系统中有且只有一个该对象

```php
<?php
class Preferences {
	private $props = [];
	private static $instance;

	private function __construct(){}

	public function setProperty ( $key , $val ) {
		$this -> props[$key] = $val;
	}

	public function getProperty( $key ){
		return $this -> props[$key];
	}
	
	public static function getInstance(){
		if( empty( self::$instance ) ){
			self::$instance = new self();
		}
		return self::$instance;
	}
}

$pref = Preferences :: getInstance();
$pref -> setProperty("name","codekissyoung");

unset($pref);
$pref2 = Preferences :: getInstance();
print $pref2 -> getProperty("name")."\n";
```

# Factory Method 工厂模式
- 抽象类高于实现
- 工厂模式就是为了解决，在抽象时，如何创建对象实例，答案就是用特定的类来处理实例化

```php
<?php
abstract class AppEncoder {/*{{{*/
	abstract function encode();
}/*}}}*/

class BloggsApptEncoder extends AppEncoder {/*{{{*/
	function encode(){
		return "Appointment data encoded in BloggsCal format \n";
	}
}/*}}}*/

class MegaApptEncoder extends AppEncoder {/*{{{*/
	function encode(){
		return "Appointment data encoded in MegaCal format \n";
	}
}/*}}}*/

// 对象工厂 用于按需求生产对象
class CommsManager {/*{{{*/

	const BLOGGS = 1;
	const MEGA   = 2;
	private $mode = 1;

	function __construct( $mode ){
		$this -> mode = $mode;
	}

	function getHeaderText() {
		switch( $this -> mode ){
			case ( self::MEGA ):
				return "MegaCal header \n";
				break;
			default:
				return "BloggsCal header \n";
				break;
		}
	}

	function getApptEncoder(){
		switch( $this -> mode ){
			case (self::MEGA):
				return new MegaApptEncoder();
				break;
			default:
				return new BloggsApptEncoder();
				break;
		}
	}
}/*}}}*/

$comms = new CommsManager( CommsManager::MEGA );
$appEncoder = $comms -> getApptEncoder();
print $comms -> getHeaderText();
print $appEncoder -> encode();
```

- 缺点 : 工厂里面有很多条件语句，如果我们加入新协议，就又要加条件，如果要加入新方法，比如`getFooterText()`,又要每个可能生成的对象写一遍条件

```php
<?php
abstract class AppEncoder {/*{{{*/
	abstract function encode();
}/*}}}*/

class BloggsApptEncoder extends AppEncoder {/*{{{*/
	function encode(){
		return "Appointment data encoded in BloggsCal format \n";
	}
}/*}}}*/

class MegaApptEncoder extends AppEncoder {/*{{{*/
	function encode(){
		return "Appointment data encoded in MegaCal format \n";
	}
}/*}}}*/

// 对抽象工厂使用多态
abstract class CommsManager {/*{{{*/
	abstract function getHeaderText();
	abstract function getApptEncoder();
	abstract function getFooterText();
}/*}}}*/

class BloggsCommsManager extends CommsManager {
	function getHeaderText(){
		return "BloggsCal Header";
	}
	function getApptEncoder(){
		return new BloggsApptEncoder();
	}
	function getFooterText(){
		return "BloggsCal Footer";
	}
}

$blog = BloggsCommsManager::getApptEncoder();
print $blog -> encode();

```




# Abstract Factory 抽象工厂模式
```php
<?php
abstract class CommsManager {
	const APPT = 1;
	const TTD = 2;
	const CONTACT = 3;
	
	abstract function getHeaderText();

//	abstract function getApptEncoder();
//	abstract function getTtdEncoder();
//	abstract function getContactEncoder();
	
	// 抽象工厂
	abstract function make( $type );
	abstract function getFooterText();

}

class BloggsCommsManager extends CommsManager {

	function getHeaderText(){
		return "BloggsCal header";
	}
/*
	function getApptEncoder(){
		return new BloggsApptEncoder();
	}

	function getTtdEncoder(){
		return new BloggsTtdEncoder();
	}

	function getContactEncoder(){
		return new BloggsContactEncoder();
	}
	
*/
	function make ( $type ) {
		switch($type){
			case self::APPT:
				return new BloggsApptEncoder();
				break;
			case self::TTD:
				return new BloggsTtdEncoder();
				break;
			case self::CONTACT:
				return new BloggsContactEncoder();
				break;
		}
	}

	function getFooterText(){
		return "BloggsCal footer \n";
	}
}
```

# Prototype 原型模式
```php
<?php
class Sea{
	private $navigability = 0;
	function __construct( $navigability ){
		$this -> navigability = $navigability;
	}
	
}
class EarthSea extends Sea {}
class MarsSea extends Sea {}

class Plains {}
class EarthPlains extends Plains{}
class MarsPlains extends Plains{}

class Forest{}
class EarthForest extends Forest {}
class MarsForest extends Forest {}

class TerrainFactory {
	
	private $sea;
	private $forest;
	private $plains;

	function __construct(Sea $sea , Plains $plains ,Forest $forest){
		$this -> sea = $sea;
		$this -> plains = $plains;
		$this -> forest = $forest;
	}

	function getSea(){
		return clone $this -> sea;
	}

	function getPlains(){
		return clone $this -> plains;
	}

	function getForest() {
		return clone $this -> forest;
	}
	
}

$factory = new TerrainFactory( new EarthSea( -1 ) ,new EarthPlains() ,new EarthForest() );
print_r( $factory -> getSea() );
print_r( $factory -> getPlains() );
print_r( $factory -> getForest() );

```

# 深复制 和 浅复制
```php
<?php
class Contained{}

// 浅复制 : $obj_copy = clone $object; 假如被复制对象里面有属性也是对象，也只是复制该属性，也就是一个引用，而不会复制对象本身
// 深复制 : 通过 __clone 魔术方法，指定在clone的时候，将对象内的对象也一并复制

class Container {
	public $con;
	function __construct(){
		$this -> con = new Contained();
	}
	// 深复制
	function __clone(){
		$this -> con = clone $this -> contained;
	}
}

```






