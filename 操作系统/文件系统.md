# 文件系统

## 存储的抽象概念

### 硬件抽象:块

第一层抽象：从一块完整磁盘到分区，每个分区可视为一块磁盘

第二层抽象：每个分区切成等份的小块(512B or 4K),从0开始编号

![image-20220313174256725](https://img.codekissyoung.com/2022/03/13/73bf40712aaf24938463b86f9c057843.png)

第三层抽象: 对编号进行区域划分（文件系统决定的）

- Ext2(Linux): superblock + inode table + data area
- FAT, NTFS(Windows): 略

![image-20220317203533056](https://img.codekissyoung.com/2022/03/17/7db341f2df00982125ab309b61a9958f.png)

### 存储抽象:文件

**superblock**：文件系统本身结构信息 ( file system type 、the size of each area )

**inode table**：单个文件的属性 (size、owner 、last modified time 、sequence of data area blocks)

> This is important：Each inode is identified by its position in the inode table. For example， inode 2 is the third struct in the inode table of the filesystem.

**data area**：data content

总结: Linux文件 = 文件系统类型 + inode (存储属性) + data(存储实际内容)

### 管理抽象:目录

- 目录是一种特殊的文件，它的内容是其他文件和目录的列表。

- the names in a directory refer to files and to other directories

> In Unix , every file on the system is located somewhere in a single tree directories. There are no separate drivers or volumes. In fact, directories on physically separate disks and partitions are seamlessly subsumed (无缝融入) into this single root tree (单目录树/).
>
> so we only think about directories and files when writing programs. no partitions and volumes.

Directories are linked together into a tree.

- how does this tree work?
- how are directories linked together?

### 文件系统抽象:文件树

#### 新建一个文件

1. Store Properties 属性
1. Store Data
1. Record Allocation 记录分配的块到属性
1. Add Filename to Direct

#### 文件树

![image-20220317203019291](https://img.codekissyoung.com/2022/03/17/9463525c7bcd4c5c7bae2452f5bbfd1f.png)![image-20220317203315834](https://img.codekissyoung.com/2022/03/17/cb5b6efde8c24966fc217d94215fcf1e.png)

**path** : demodir/c/dl/xlink

#### 



#### 目录是怎么连接的













![image-20220313212723786](https://img.codekissyoung.com/2022/03/13/dfdf0ea4dd189ca63f77d3f95c33e27c.png)

















