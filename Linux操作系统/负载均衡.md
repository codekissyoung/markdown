# 负载均衡

## 利用DNS轮询方式实现

- 实现:在域名商那里设置同一个域名到多个IP的A记录就行，非常简单
- 缺点1:可靠性低，假如启动一台服务器发生故障，把该服务器IP从域名映射中删除，还需要`TTL`时间段，去刷新全网的DNS缓存
- 缺点2:负载分配不平衡，性能强的服务器与性能差的服务器获得一样的流量
- 适用对象:可靠性要求不高的服务器集群，比如图片服务器集群、纯静态网页服务器集群

```bash
➜  html dig nginx.codekissyoung.com
; <<>> DiG 9.11.3-1ubuntu1.2-Ubuntu <<>> nginx.codekissyoung.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 7153
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;nginx.codekissyoung.com.	IN	A

;; ANSWER SECTION:
nginx.codekissyoung.com. 600	IN	A	101.200.144.41
nginx.codekissyoung.com. 600	IN	A	60.205.177.197

;; Query time: 5 msec
;; SERVER: 127.0.0.53#53(127.0.0.53)
;; WHEN: Thu Oct 11 17:47:08 CST 2018
;; MSG SIZE  rcvd: 84
```

### 多线多地区智能DNS解析与混合负载均衡方式

- 原理：根据用户本地设置的DNS服务器线路和地区，将对同一个域名解析到不同的IP上去，比如北京电信用户访问，则解析到北京机房的IP;
 



## 四层负载均衡

- 原理，将一个公网IP映射为多个内部服务器的IP,对每次TCP链接请求动态使用其中一个内部IP地址提供服务，从而达到负载均衡的目的。

## 七层负载均衡

- 原理，通过检查HTTP报文头部，根据里面信息来执行负载均衡任务