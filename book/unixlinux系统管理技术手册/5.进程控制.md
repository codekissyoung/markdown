# 进程组成部分 (内核的内部数据结构记录的)
- 进程地址空间映射
- 当前状态(睡眠 停止 可运行)
- 进程优先级
- 进程已用资源信息
- 进程打开的文件和网络端口信息
- 进程的信号掩码 (一个记录 确定要封锁哪些信号)
- 进程的属主

# PID

# PPID
- linux 没有提供创建新进程去运行某个特定程序的系统调用，现有进程必须克隆自身去创建一个新进程，克隆出的进程能够把它正在运行的那个程序替换成另一个不同程序
- 新进程的 PPID 就是那个克隆自身的进程的PID, 它可以用来回溯进程的来源(是一个shell还是另一个程序)

# UID 和 EUID
- 进程的所属用户  和  有效所属用户

# GID 和 EGID
- 进程的用户组ID 和 有效用户组ID

# 进程的生命周期
- 进程 A 调用 `fork` 来复制自身,得到进程 B , 对于 A 进程 fork 返回 B 的PID,对于B 进程 fork 返回 0
- `fork`之后 , B 进程可以调用 `exec`族 函数 , 来执行新的程序, 这些调用能改变 B 进程的 .text (程序正文)，并把内存段重置为预先定义的初始状态
- 除了内核在初始化时创建的几个内核进程, 其余的进程都是 `init` 进程的子进程
- B 进程调用 `_exit` 例程来通知内核 结束进程 , A 进程必须调用 wait 来确认 B 的结束, 但是如果 A 进程已经早于 B 进程结束的话，B 进程就成了孤儿进程, 则由 `init` 来成为B的父进程 , 调用`wait`来清理

# 信号
- 信号是进程级的中断请求
- 作为一种通信手段，进程之间可以发送信号
- 当输入`Ctrl + C` `Ctrl + z`时，可以由终端驱动程序发送信号去终止/中断/挂起进程
- 可以由管理员 使用 kill 发送信号来达到各种效果
- 当进程出错，比如`0作除数`,可以由进程来发送信号
- 可以由内核发送信号，通知一个进程 "有受关注的条件"出现，比如子进程死亡，或者I/O通道上有数据
- 进程收到信号后，可以调用自身已经写好的处理这个信号的例程来处理
- 当然，如果没有写处理例程的话，内核就会代表该进程采取默认措施，比如有些信号会终止进程
- 有些信号就会产生 core 文件 (内存转储文件 core dump), 就是将当时进程的内存状态保存下来， core 理解为内存 ，是旧词沿用下来的含义
- 为了防止收到信号，进程也可以选择 ignore 或者 block 某些信号，
- `kill -l` 可以查看有哪些信号
    ```
    ➜  blog git:(master) kill -l
    HUP INT QUIT ILL TRAP ABRT BUS FPE KILL USR1 SEGV USR2 PIPE ALRM TERM STKFLT CHLD CONT STOP TSTP TTIN TTOU URG XCPU XFSZ VTALRM PROF WINCH POLL PWR SYS
    ```
- KILL 不可以Block(封锁),它直接在内核层面终止进程
- INT 中断 `Ctrl + C`发送的信号
- TERM 软件终止 进程清除自己的状态并且退出
- HUP 挂起
- QUIT 退出
- `kill [-signal] PID` 给某个进程发送信号 , 如 `kill -9 20395`

# 进程的状态
- Runnable 可运行 进程已经准备好运行了
- Sleeping 睡眠 ， 进程在等待某些资源
- Zombie , 进程试图消亡
- Stopped , 进程被挂起 不允许执行


# nice 和 renice 影响调度优先级
- `nice -n 5 ~/bin/longtask` 将谦让度设置为 5 , 即让其他进程优先执行
- `renice -5 8809` 将谦让值设置为 -5 , 即抢占执行
- `renice 5 -u cky` 将cky的程序的谦让度设置为5


# ps 监视进程
- `ps aux` 了解正在系统上运行的所有进程的全貌
- `ps lax` 长模式 ，显示了 PPID 谦让值 NI 进程正在等待的资源

# top 监视进程


# /proc 文件系统
- ps 和 top 都是从 /proc 目录里面读取的进程状态信息, 内核把有关系统状态的各种信息都写在这个目录里面了
- 可以通过向 /proc 下适当文件写入数据来修改某些参数
```
➜  ~ cat /proc/version
Linux version 4.10.0-21-generic (buildd@lgw01-12) (gcc version 6.3.0 20170406 (Ubuntu 6.3.0-12ubuntu2) ) #23-Ubuntu SMP Fri Apr 28 16:14:22 UTC 2017
```

# strace 追踪某个进程的信号和系统调用
```c
➜  ~ sudo strace -p 7777
[sudo] cky 的密码：
strace: Process 7777 attached
restart_syscall(<... resuming interrupted poll ...>) = 0
recvmsg(30, 0x7ffc38c36be0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
write(41, "!", 1)                       = 1
write(41, "!", 1)                       = 1
recvmsg(18, 0x7ffc38c36ba0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
recvmsg(30, 0x7ffc38c36bb0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
poll([{fd=18, events=POLLIN}, {fd=19, events=POLLIN}, {fd=23, events=POLLIN}, {fd=30, events=POLLIN}, {fd=33, events=POLLIN}, {fd=40, events=POLLIN}], 6, 0) = 1 ([{fd=40, revents=POLLIN}])
recvmsg(30, 0x7ffc38c36be0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
read(40, "!!", 2)                       = 2
recvmsg(18, 0x7ffc38c36ba0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
recvmsg(30, 0x7ffc38c36bb0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
poll([{fd=18, events=POLLIN}, {fd=19, events=POLLIN}, {fd=23, events=POLLIN}, {fd=30, events=POLLIN}, {fd=33, events=POLLIN}, {fd=40, events=POLLIN}], 6, 0) = 0 (Timeout)
recvmsg(30, 0x7ffc38c36be0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
recvmsg(18, 0x7ffc38c36ba0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
recvmsg(30, 0x7ffc38c36bb0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
poll([{fd=18, events=POLLIN}, {fd=19, events=POLLIN}, {fd=23, events=POLLIN}, {fd=30, events=POLLIN}, {fd=33, events=POLLIN}, {fd=40, events=POLLIN}], 6, 499) = 0 (Timeout)
recvmsg(30, 0x7ffc38c36be0, 0)          = -1 EAGAIN (Resource temporarily unavailable)
write(41, "!", 1)                       = 1
write(41, "!", 1)                       = 1
```
