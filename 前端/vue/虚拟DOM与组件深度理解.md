# è™šæ‹ŸDOMä¸ç»„ä»¶æ·±åº¦ç†è§£

> **å­¦ä¹ æ—¶é—´**: 2025-08-01  
> **æŠ€æœ¯æ ˆ**: Vue 3, è™šæ‹ŸDOM, ç»„ä»¶ç³»ç»Ÿ  
> **é‡è¦ç¨‹åº¦**: â­â­â­â­â­ (æ ¸å¿ƒç†è®ºåŸºç¡€)

## æ¦‚è¿°

ä»Šå¤©æ·±å…¥ç†è§£äº†Vue 3åº•å±‚æœ€æ ¸å¿ƒçš„æ¦‚å¿µï¼š**è™šæ‹ŸDOMå¦‚ä½•æè¿°ç»„ä»¶**ã€‚è¿™ä¸ªç†è§£è®©æˆ‘ä»"ä¼šç”¨Vue"æå‡åˆ°äº†"ç†è§£Vueè®¾è®¡åŸç†"çš„å±‚æ¬¡ï¼Œæ˜¯å‰ç«¯æ¡†æ¶å­¦ä¹ çš„é‡è¦çªç ´ã€‚

## ç»„ä»¶çš„æœ¬è´¨ç†è§£

**æ ¸å¿ƒæ¦‚å¿µ**: ç»„ä»¶å°±æ˜¯ä¸€ç»„DOMå…ƒç´ çš„å°è£…

è¿™å¥è¯æ˜¯ç†è§£è™šæ‹ŸDOMæè¿°ç»„ä»¶çš„å…³é”®ã€‚ç»„ä»¶é€šè¿‡å‡½æ•°å°è£…å†…éƒ¨é€»è¾‘å’ŒDOMç»“æ„ï¼Œå®ç°å¤ç”¨å’Œä½œç”¨åŸŸéš”ç¦»ã€‚

### ä¼ ç»Ÿç†è§£ vs æ·±åº¦ç†è§£

**ä¼ ç»Ÿç†è§£**: ç»„ä»¶å°±æ˜¯ä¸€ä¸ª.vueæ–‡ä»¶ï¼ŒåŒ…å«templateã€scriptã€style
**æ·±åº¦ç†è§£**: ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æè¿°äº†è¦æ¸²æŸ“çš„DOMç»“æ„

## è™šæ‹ŸDOMçš„ä¸¤ç§æè¿°æ–¹å¼

### 1. æè¿°çœŸå®DOMå…ƒç´ 

```javascript
// ç›´æ¥æè¿°çœŸå®DOMæ ‡ç­¾
{
  tag: 'div',
  props: {
    onClick: () => alert('hello')
  },
  children: 'click me'
}
// å¯¹åº”çœŸå®DOM: <div onclick="...">click me</div>
```

**ç‰¹ç‚¹**:
- é™æ€æè¿°
- ç›´æ¥å¯¹åº”HTMLæ ‡ç­¾
- æ²¡æœ‰å†…éƒ¨çŠ¶æ€
- ä¸å¯å¤ç”¨

### 2. æè¿°ç»„ä»¶

```javascript
// ç”¨å‡½æ•°æè¿°ç»„ä»¶ï¼Œå‡½æ•°è¿”å›å€¼ä»£è¡¨è¦æ¸²æŸ“çš„å†…å®¹
const MyComponent = function () {
  return {
    tag: 'div',
    props: {
      onClick: () => alert('hello')
    },
    children: 'click me'
  }
}
```

**ç‰¹ç‚¹**:
- åŠ¨æ€ç”Ÿæˆ
- å¯ä»¥åŒ…å«å†…éƒ¨çŠ¶æ€
- æ”¯æŒå‚æ•°åŒ–
- å¯å¤ç”¨

## ä¸ºä»€ä¹ˆç”¨å‡½æ•°æè¿°ç»„ä»¶ï¼Ÿ

### 1. åŠ¨æ€æ€§éœ€æ±‚

```javascript
// ç»„ä»¶å¯ä»¥æ ¹æ®å‚æ•°åŠ¨æ€ç”Ÿæˆä¸åŒå†…å®¹
const MyComponent = function(props) {
  return {
    tag: 'div',
    children: props.message  // æ ¹æ®ä¼ å…¥çš„propsåŠ¨æ€æ”¹å˜
  }
}

// ä½¿ç”¨æ—¶å¯ä»¥ä¼ å…¥ä¸åŒå‚æ•°
MyComponent({message: 'Hello'})  // æ¸²æŸ“ "Hello"
MyComponent({message: 'World'})  // æ¸²æŸ“ "World"
```

**å…³é”®ç†è§£**: 
- çœŸå®DOMå…ƒç´ æ˜¯"æ­»çš„"ï¼Œå†…å®¹å›ºå®š
- ç»„ä»¶æ˜¯"æ´»çš„"ï¼Œå¯ä»¥æ ¹æ®è¾“å…¥äº§ç”Ÿä¸åŒè¾“å‡º

### 2. å°è£…å’Œå¤ç”¨

```javascript
// ç»„ä»¶å¯ä»¥åŒ…å«å†…éƒ¨çŠ¶æ€å’Œé€»è¾‘
const Counter = function() {
  let count = 0  // ç»„ä»¶å†…éƒ¨çŠ¶æ€
  
  return {
    tag: 'div',
    children: [
      { tag: 'span', children: `Count: ${count}` },
      { 
        tag: 'button', 
        props: { 
          onClick: () => {
            count++  // ç‚¹å‡»åæ›´æ–°çŠ¶æ€
            // é‡æ–°æ¸²æŸ“
          }
        },
        children: '+1'
      }
    ]
  }
}
```

**å…³é”®ç†è§£**:
- ç»„ä»¶å°è£…äº†çŠ¶æ€å’Œé€»è¾‘
- å¤–éƒ¨åªéœ€è¦å…³å¿ƒ"ç”¨ä»€ä¹ˆ"ï¼Œä¸éœ€è¦å…³å¿ƒ"å¦‚ä½•å®ç°"
- åŒä¸€ä¸ªç»„ä»¶å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨ï¼Œå„è‡ªç‹¬ç«‹

### 3. ç”Ÿå‘½å‘¨æœŸç®¡ç†

```javascript
// ç»„ä»¶æœ‰ä»åˆ›å»ºåˆ°é”€æ¯çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
const MyComponent = function() {
  // ç»„ä»¶åˆ›å»ºæ—¶æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
  console.log('ç»„ä»¶åˆ›å»º')
  const data = fetchData()
  
  return {
    tag: 'div',
    children: data
  }
}
```

**å…³é”®ç†è§£**:
- ç»„ä»¶ä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæœ‰å®Œæ•´çš„ç®¡ç†å‘¨æœŸ
- åˆ›å»ºã€æ›´æ–°ã€é”€æ¯éƒ½æœ‰å¯¹åº”çš„å¤„ç†é€»è¾‘
- è¿™æ˜¯æ¡†æ¶ç®¡ç†ç»„ä»¶çš„åŸºç¡€

### 4. ä½œç”¨åŸŸéš”ç¦»

```javascript
// æ¯ä¸ªç»„ä»¶å‡½æ•°éƒ½æœ‰ç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œä¸ä¼šç›¸äº’æ±¡æŸ“
const ComponentA = function() {
  const localVar = 'Açš„ç§æœ‰å˜é‡'
  return { tag: 'div', children: localVar }
}

const ComponentB = function() {
  const localVar = 'Bçš„ç§æœ‰å˜é‡'  // å®Œå…¨ç‹¬ç«‹
  return { tag: 'div', children: localVar }
}
```

**å…³é”®ç†è§£**:
- æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„
- ä¸ä¼šå‡ºç°å˜é‡å†²çª
- è¿™æ˜¯å¤§å‹åº”ç”¨èƒ½ç¨³å®šè¿è¡Œçš„åŸºç¡€

## ä¸Vue 3 Composition APIçš„å¯¹åº”å…³ç³»

åœ¨Vue 3ä¸­ï¼Œ`<script setup>`æœ¬è´¨ä¸Šå°±æ˜¯è¿™ä¸ªæ€æƒ³çš„ä½“ç°ï¼š

```vue
<script setup>
import { ref } from 'vue'

const count = ref(0)  // ç»„ä»¶å†…éƒ¨çŠ¶æ€
const message = 'Hello'  // ç»„ä»¶å†…éƒ¨æ•°æ®

function handleClick() {
  count.value++  // ç»„ä»¶å†…éƒ¨é€»è¾‘
}
</script>

<template>
  <div @click="handleClick">
    {{ message }}: {{ count }}
  </div>
</template>
```

**å¯¹åº”å…³ç³»**:
- `<script setup>` = å®šä¹‰ç»„ä»¶å‡½æ•°
- `ref()` = åˆ›å»ºç»„ä»¶å†…éƒ¨çŠ¶æ€
- å‡½æ•°å†…çš„å˜é‡ = ç»„ä»¶çš„ç§æœ‰å˜é‡
- `template` = å‡½æ•°è¿”å›å€¼çš„ç®€åŒ–å†™æ³•

Vueçš„ç¼–è¯‘å™¨ä¼šæŠŠä¸Šé¢çš„ä»£ç è½¬æ¢æˆç±»ä¼¼è¿™æ ·çš„è™šæ‹ŸDOMæè¿°ï¼š

```javascript
const MyComponent = function() {
  const count = ref(0)
  const message = 'Hello'
  
  function handleClick() {
    count.value++
  }
  
  return {
    tag: 'div',
    props: {
      onClick: handleClick
    },
    children: `${message}: ${count.value}`
  }
}
```

## æ ¸å¿ƒè®¾è®¡ç†å¿µæ€»ç»“

ç”¨å‡½æ•°æè¿°ç»„ä»¶ä½“ç°äº†**å‡½æ•°å¼ç¼–ç¨‹**çš„æ€æƒ³ï¼š

### 1. åŠ¨æ€æ€§
- ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º
- æ”¯æŒå‚æ•°åŒ–é…ç½®
- å¯ä»¥æ ¹æ®å¤–éƒ¨æ¡ä»¶å˜åŒ–

### 2. å°è£…æ€§
- ç»„ä»¶å†…éƒ¨çŠ¶æ€å’Œé€»è¾‘å®Œå…¨éš”ç¦»
- å¤–éƒ¨é€šè¿‡propsè¿›è¡Œé€šä¿¡
- å®ç°äº†ä¿¡æ¯éšè—

### 3. å¤ç”¨æ€§
- åŒä¸€ä¸ªç»„ä»¶å¯ä»¥åœ¨å¤šå¤„ä½¿ç”¨
- å„ä¸ªå®ä¾‹å®Œå…¨ç‹¬ç«‹
- æé«˜äº†å¼€å‘æ•ˆç‡

### 4. å¯é¢„æµ‹æ€§
- çº¯å‡½æ•°ç‰¹æ€§è®©ç»„ä»¶è¡Œä¸ºæ›´å®¹æ˜“ç†è§£
- ç›¸åŒçš„è¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„è¾“å‡º
- ä¾¿äºæµ‹è¯•å’Œè°ƒè¯•

## è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿

### 1. ç»Ÿä¸€çš„æè¿°æ–¹å¼
è™šæ‹ŸDOMæ—¢èƒ½æè¿°é™æ€çš„DOMå…ƒç´ ï¼Œåˆèƒ½æè¿°åŠ¨æ€çš„ã€æœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œä¸ºæ•´ä¸ªæ¡†æ¶æä¾›äº†ç»Ÿä¸€çš„ç†è®ºåŸºç¡€ã€‚

### 2. æ€§èƒ½ä¼˜åŒ–
é€šè¿‡å‡½æ•°è°ƒç”¨ç”Ÿæˆè™šæ‹ŸDOMï¼Œæ¡†æ¶å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œå„ç§ä¼˜åŒ–ï¼š
- å¯ä»¥ç¼“å­˜å‡½æ•°ç»“æœ
- å¯ä»¥è¿›è¡Œdiffç®—æ³•æ¯”è¾ƒ
- å¯ä»¥æŒ‰éœ€æ›´æ–°

### 3. å¼€å‘ä½“éªŒ
å¼€å‘è€…åªéœ€è¦å…³æ³¨"è¦æ¸²æŸ“ä»€ä¹ˆ"ï¼Œè€Œä¸éœ€è¦å…³æ³¨"å¦‚ä½•æ¸²æŸ“"ï¼š
- å£°æ˜å¼ç¼–ç¨‹
- æ•°æ®é©±åŠ¨
- çŠ¶æ€ç®¡ç†

## å®é™…åº”ç”¨åœºæ™¯

### 1. æ¡ä»¶æ¸²æŸ“
```javascript
const ConditionalComponent = function(props) {
  if (props.show) {
    return { tag: 'div', children: 'æ˜¾ç¤ºå†…å®¹' }
  } else {
    return { tag: 'div', children: 'éšè—å†…å®¹' }
  }
}
```

### 2. åˆ—è¡¨æ¸²æŸ“
```javascript
const ListComponent = function(props) {
  return {
    tag: 'div',
    children: props.items.map(item => ({
      tag: 'div',
      children: item.name
    }))
  }
}
```

### 3. ç»„ä»¶åµŒå¥—
```javascript
const ParentComponent = function() {
  return {
    tag: 'div',
    children: [
      { tag: 'h1', children: 'çˆ¶ç»„ä»¶' },
      // å­ç»„ä»¶ä½œä¸ºchildrençš„ä¸€éƒ¨åˆ†
      ChildComponent()
    ]
  }
}
```

## å­¦ä¹ å¿ƒå¾—

### 1. ä»è¡¨é¢åˆ°æœ¬è´¨
ä»¥å‰ç”¨Vueåªæ˜¯åœç•™åœ¨APIå±‚é¢ï¼Œç°åœ¨ç†è§£äº†åº•å±‚çš„è™šæ‹ŸDOMæœºåˆ¶ï¼Œå¯¹Vueçš„è®¾è®¡ç†å¿µæœ‰äº†æ›´æ·±çš„è®¤è¯†ã€‚

### 2. å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³
ç†è§£äº†å‡½æ•°å¼ç¼–ç¨‹åœ¨å‰ç«¯æ¡†æ¶ä¸­çš„åº”ç”¨ï¼Œè¿™å¯¹æˆ‘ä»¥åå­¦ä¹ å…¶ä»–æ¡†æ¶ä¹Ÿæœ‰å¸®åŠ©ã€‚

### 3. è®¾è®¡æ¨¡å¼çš„ä½“ç°
çœ‹åˆ°äº†è®¾è®¡æ¨¡å¼åœ¨å®é™…æ¡†æ¶ä¸­çš„åº”ç”¨ï¼Œæ¯”å¦‚å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰ã€‚

### 4. ä¸ºé«˜çº§ç‰¹æ€§æ‰“åŸºç¡€
ç†è§£äº†è¿™ä¸ªåŸºç¡€æ¦‚å¿µï¼Œä¸ºä»¥åå­¦ä¹ Vueçš„é«˜çº§ç‰¹æ€§ï¼ˆå¦‚è‡ªå®šä¹‰æŒ‡ä»¤ã€æ’ä»¶å¼€å‘ç­‰ï¼‰æ‰“ä¸‹äº†åšå®åŸºç¡€ã€‚

## ä¸‹ä¸€æ­¥å­¦ä¹ è®¡åˆ’

1. **æ¸²æŸ“å™¨æœºåˆ¶**: æ·±å…¥ç†è§£Vueå¦‚ä½•å°†è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOM âœ… **å·²å®Œæˆ**
2. **å“åº”å¼ç³»ç»Ÿ**: ç†è§£Vueå¦‚ä½•æ£€æµ‹æ•°æ®å˜åŒ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“
3. **ç¼–è¯‘å™¨ä¼˜åŒ–**: äº†è§£Vue 3çš„ç¼–è¯‘æ—¶ä¼˜åŒ–æœºåˆ¶ âœ… **å·²å®Œæˆ**
4. **æ€§èƒ½ä¼˜åŒ–**: åŸºäºè¿™äº›ç†è§£è¿›è¡Œå®é™…çš„æ€§èƒ½ä¼˜åŒ–

---

## è™šæ‹ŸDOMæ¸²æŸ“å™¨å®Œæ•´æœºåˆ¶ ğŸš€

> **æ›´æ–°æ—¶é—´**: 2025-08-01 ç»§ç»­æ·±å…¥  
> **æ–°å¢å†…å®¹**: æ¸²æŸ“å™¨å®ç°ã€ç¼–è¯‘å™¨åŸç†ã€å®Œæ•´æ¸²æŸ“æµç¨‹

### æ¸²æŸ“å™¨çš„æ ¸å¿ƒå®ç°

é€šè¿‡æ·±å…¥ç†è§£æ¸²æŸ“å™¨çš„ä»£ç å®ç°ï¼Œæˆ‘å¯¹è™šæ‹ŸDOMåˆ°çœŸå®DOMçš„è½¬æ¢è¿‡ç¨‹æœ‰äº†å®Œæ•´çš„è®¤è¯†ï¼š

#### 1. ç±»å‹åˆ¤æ–­æœºåˆ¶

```javascript
function renderer(vnode, container) {
  if (typeof vnode.tag === 'string') {
    // æ™®é€šDOMå…ƒç´ 
    mountElement(vnode, container)
  } else if (typeof vnode.tag === 'function') {
    // ç»„ä»¶
    mountComponent(vnode, container)
  }
}
```

**å…³é”®ç†è§£**:
- `vnode.tag` ç±»å‹æ˜¯å­—ç¬¦ä¸² â†’ æ™®é€šDOMå…ƒç´ 
- `vnode.tag` ç±»å‹æ˜¯å‡½æ•° â†’ ç»„ä»¶
- è¿™æ˜¯æ¸²æŸ“å™¨åŒºåˆ†å…ƒç´ å’Œç»„ä»¶çš„æ ¸å¿ƒæœºåˆ¶

#### 2. `mountElement` å‡½æ•°è¯¦è§£

```javascript
function mountElement(vnode, container) {
  // åˆ›å»ºDOMå…ƒç´ 
  const el = document.createElement(vnode.tag)
  
  // å¤„ç†å±æ€§å’Œäº‹ä»¶
  for (const key in vnode.props) {
    if (/^on/.test(key)) {
      // äº‹ä»¶å¤„ç†: onClick â†’ addEventListener('click', ...)
      el.addEventListener(
        key.substr(2).toLowerCase(),
        vnode.props[key]
      )
    }
  }
  
  // é€’å½’å¤„ç†å­èŠ‚ç‚¹
  if (typeof vnode.children === 'string') {
    el.appendChild(document.createTextNode(vnode.children))
  } else if (Array.isArray(vnode.children)) {
    vnode.children.forEach(child => renderer(child, el))
  }
  
  // æŒ‚è½½åˆ°å®¹å™¨
  container.appendChild(el)
}
```

**æ ¸å¿ƒè¦ç‚¹**:
- **DOMåˆ›å»º**: è™šæ‹ŸDOMæ ‡ç­¾ â†’ çœŸå®DOMå…ƒç´ 
- **äº‹ä»¶è½¬æ¢**: Vueçš„`@click` â†’ åŸç”Ÿ`addEventListener`
- **é€’å½’æ¸²æŸ“**: å¤„ç†æ•´ä¸ªè™šæ‹ŸDOMæ ‘çš„å…³é”®
- **ç»Ÿä¸€æ¥å£**: æ— è®ºæ˜¯å…ƒç´ è¿˜æ˜¯ç»„ä»¶ï¼Œéƒ½é€šè¿‡`renderer`å¤„ç†

#### 3. `mountComponent` å‡½æ•°çš„ç²¾å¦™è®¾è®¡

```javascript
function mountComponent(vnode, container) {
  // è°ƒç”¨ç»„ä»¶å‡½æ•°è·å–è™šæ‹ŸDOM
  const subtree = vnode.tag()
  // é€’å½’æ¸²æŸ“å­æ ‘
  renderer(subtree, container)
}
```

**è®¾è®¡ç²¾é«“**:
- **ç»„ä»¶å®ä¾‹åŒ–**: è°ƒç”¨ç»„ä»¶å‡½æ•°è·å–è¦æ¸²æŸ“çš„å†…å®¹
- **é€’å½’è°ƒç”¨**: ç»„ä»¶è¿”å›çš„è™šæ‹ŸDOMå†æ¬¡äº¤ç»™`renderer`å¤„ç†
- **ç»Ÿä¸€å¤„ç†**: ç»„ä»¶å’Œå…ƒç´ æœ€ç»ˆéƒ½èµ°åŒä¸€å¥—æ¸²æŸ“æµç¨‹

### å®Œæ•´çš„æ¸²æŸ“æµç¨‹ç¤ºä¾‹

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåµŒå¥—ç»„ä»¶çš„ä¾‹å­æ¥ç†è§£å®Œæ•´çš„æ¸²æŸ“æµç¨‹ï¼š

```javascript
// å­ç»„ä»¶
const ChildComponent = function() {
  return {
    tag: 'span',
    children: 'æˆ‘æ˜¯å­ç»„ä»¶'
  }
}

// çˆ¶ç»„ä»¶
const ParentComponent = function() {
  return {
    tag: 'div',
    children: [
      { tag: 'h1', children: 'çˆ¶ç»„ä»¶' },
      { tag: ChildComponent }  // åµŒå¥—å­ç»„ä»¶
    ]
  }
}

// æ¸²æŸ“è°ƒç”¨
renderer({ tag: ParentComponent }, document.body)
```

**é€’å½’è°ƒç”¨é“¾**:
```
renderer(ParentComponent) 
  â†’ mountComponent(ParentComponent)
    â†’ ParentComponent() è¿”å›è™šæ‹ŸDOM
    â†’ renderer(çˆ¶ç»„ä»¶çš„div)
      â†’ mountElement(div)
        â†’ renderer(h1) â†’ mountElement(h1)
        â†’ renderer(ChildComponent) 
          â†’ mountComponent(ChildComponent)
            â†’ ChildComponent() è¿”å›è™šæ‹ŸDOM
            â†’ renderer(span) â†’ mountElement(span)
```

### ç¼–è¯‘å™¨çš„ä½œç”¨ï¼šæ¨¡æ¿åˆ°æ¸²æŸ“å‡½æ•°çš„è½¬æ¢

#### æ¨¡æ¿çš„æœ¬è´¨

å¯¹ç¼–è¯‘å™¨æ¥è¯´ï¼Œæ¨¡æ¿å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼š

```javascript
const template = `
<div @click="handler">
  click me
</div>
`
```

#### ç¼–è¯‘å™¨çš„å·¥ä½œæµç¨‹

1. **è§£æ (Parse)**: æ¨¡æ¿å­—ç¬¦ä¸² â†’ æŠ½è±¡è¯­æ³•æ ‘ (AST)
2. **è½¬æ¢ (Transform)**: å¯¹ASTè¿›è¡Œä¼˜åŒ–å’Œè½¬æ¢  
3. **ä»£ç ç”Ÿæˆ (Generate)**: AST â†’ æ¸²æŸ“å‡½æ•°ä»£ç 

#### è½¬æ¢ç¤ºä¾‹

**æ¨¡æ¿**:
```vue
<template>
  <div @click="handler">
    click me
  </div>
</template>
```

**ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°**:
```javascript
render() {
  return h('div', { onClick: handler }, 'click me')
}
```

**å…¶ä¸­ `h` å‡½æ•°çš„ä½œç”¨**:
```javascript
h('div', { onClick: handler }, 'click me')
// ç­‰ä»·äºï¼š
{
  tag: 'div',
  props: { onClick: handler },
  children: 'click me'
}
```

### Vue.jså®Œæ•´æ¸²æŸ“é“¾æ¡

```
å¼€å‘è€…ç¼–å†™æ¨¡æ¿
    â†“
ç¼–è¯‘å™¨ (æ„å»ºæ—¶)
    â†“
æ¸²æŸ“å‡½æ•° (è¿è¡Œæ—¶)
    â†“
è™šæ‹ŸDOM (ç»Ÿä¸€æè¿°)
    â†“
æ¸²æŸ“å™¨ (æ ¸å¿ƒæœºåˆ¶)
    â†“
çœŸå®DOM (ç”¨æˆ·çœ‹åˆ°)
```

### å„ä¸ªç»„ä»¶çš„èŒè´£åˆ†å·¥

- **æ¨¡æ¿**: å¼€å‘è€…å‹å¥½çš„å£°æ˜å¼UIæè¿°
- **ç¼–è¯‘å™¨**: æ¨¡æ¿â†’æ¸²æŸ“å‡½æ•°çš„è½¬æ¢å™¨ï¼Œè´Ÿè´£è¯­æ³•è§£æå’Œä¼˜åŒ–
- **æ¸²æŸ“å‡½æ•°**: è¿”å›è™šæ‹ŸDOMçš„å‡½æ•°ï¼Œæ˜¯ç¼–è¯‘åçš„ç»“æœ
- **è™šæ‹ŸDOM**: UIçš„JavaScriptå¯¹è±¡æè¿°ï¼Œç»Ÿä¸€äº†ä¸åŒå¹³å°çš„è¡¨ç¤º
- **æ¸²æŸ“å™¨**: è™šæ‹ŸDOMâ†’çœŸå®DOMçš„è½¬æ¢å™¨ï¼Œè´Ÿè´£å…·ä½“çš„DOMæ“ä½œ

### ç¼–è¯‘å™¨çš„æ ¸å¿ƒä¼˜åŠ¿

#### 1. æ€§èƒ½ä¼˜åŒ–
```javascript
// é™æ€æå‡ - å°†ä¸å˜çš„èŠ‚ç‚¹æå–å‡ºæ¥
const _hoisted_1 = h('div', { class: 'static' }, 'static content')

render() {
  return h('div', null, [
    _hoisted_1,  // ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„è™šæ‹ŸDOM
    h('span', null, dynamicContent)  // åŠ¨æ€å†…å®¹
  ])
}
```

#### 2. è¯­æ³•ç³–æ”¯æŒ
```vue
<!-- v-if -->
<div v-if="show">Content</div>
<!-- ç¼–è¯‘å -->
show ? h('div', null, 'Content') : null

<!-- v-for -->
<div v-for="item in items" :key="item.id">{{ item }}</div>
<!-- ç¼–è¯‘å -->
items.map(item => h('div', { key: item.id }, item))
```

#### 3. é”™è¯¯æ£€æŸ¥
ç¼–è¯‘æ—¶å¯ä»¥å‘ç°æ¨¡æ¿ä¸­çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯ç­‰åˆ°è¿è¡Œæ—¶ã€‚

### è®¾è®¡ç†å¿µçš„æ·±åº¦ç†è§£

#### 1. å£°æ˜å¼ç¼–ç¨‹
å¼€å‘è€…åªéœ€è¦æè¿°"è¦æ¸²æŸ“ä»€ä¹ˆ"ï¼Œä¸éœ€è¦å…³å¿ƒ"å¦‚ä½•æ¸²æŸ“"ã€‚

#### 2. å…³æ³¨ç‚¹åˆ†ç¦»
- **ç¼–è¯‘æ—¶**: æ¨¡æ¿è§£æã€ä¼˜åŒ–ã€ä»£ç ç”Ÿæˆ
- **è¿è¡Œæ—¶**: è™šæ‹ŸDOMåˆ›å»ºã€DOMæ“ä½œã€äº‹ä»¶å¤„ç†

#### 3. è·¨å¹³å°èƒ½åŠ›
åŒä¸€å¥—è™šæ‹ŸDOMæè¿°å¯ä»¥æ”¯æŒä¸åŒå¹³å°çš„æ¸²æŸ“ï¼š
- æµè§ˆå™¨ï¼š`document.createElement`
- æœåŠ¡å™¨ï¼šç”ŸæˆHTMLå­—ç¬¦ä¸²  
- åŸç”Ÿåº”ç”¨ï¼šè°ƒç”¨åŸç”ŸUIç»„ä»¶

### å®é™…å¼€å‘ä¸­çš„åº”ç”¨ä»·å€¼

#### 1. è°ƒè¯•èƒ½åŠ›
ç†è§£è¿™ä¸ªæœºåˆ¶åï¼Œå¯ä»¥ï¼š
- æŸ¥çœ‹ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°æ¥è°ƒè¯•æ¨¡æ¿é—®é¢˜
- ç†è§£VueæŒ‡ä»¤çš„å·¥ä½œåŸç†
- åˆ†ææ€§èƒ½ç“¶é¢ˆçš„æ¥æº

#### 2. æ€§èƒ½ä¼˜åŒ–
- çŸ¥é“å“ªäº›å†…å®¹ä¼šè¢«é™æ€æå‡
- ç†è§£ä¸ºä»€ä¹ˆæŸäº›å†™æ³•æ€§èƒ½æ›´å¥½
- å¯ä»¥æ‰‹åŠ¨ç¼–å†™æ¸²æŸ“å‡½æ•°å¤„ç†ç‰¹æ®Šåœºæ™¯

#### 3. æ¶æ„è®¾è®¡
- ç†è§£ç»„ä»¶åŒ–è®¾è®¡çš„åº•å±‚åŸç†
- æŒæ¡çŠ¶æ€ç®¡ç†å’ŒUIæ¸²æŸ“çš„å…³ç³»
- ä¸ºå­¦ä¹ å…¶ä»–æ¡†æ¶æ‰“ä¸‹åŸºç¡€

### subtree çš„æ·±åº¦ç†è§£

> **æ–°å¢ç†è§£æ—¶é—´**: 2025-08-01  
> **æ ¸å¿ƒæ¦‚å¿µ**: ç»„ä»¶æ¸²æŸ“å‡½æ•°è¿”å›çš„è™šæ‹ŸDOMå­æ ‘

#### ä»€ä¹ˆæ˜¯ subtreeï¼Ÿ

`subtree` å°±æ˜¯ç»„ä»¶å‡½æ•°æ‰§è¡Œåè¿”å›çš„**è™šæ‹ŸDOMå­æ ‘**ã€‚è¿™æ˜¯ç†è§£ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹çš„å…³é”®æ¦‚å¿µã€‚

```javascript
const ChildComponent = function() {
  // ç»„ä»¶å‡½æ•°è¿”å›çš„è™šæ‹ŸDOMå°±æ˜¯ subtree
  const subtree = {
    tag: 'span',
    children: 'æˆ‘æ˜¯å­ç»„ä»¶'
  }
  return subtree
}

// åœ¨ mountComponent å‡½æ•°ä¸­ï¼š
function mountComponent(vnode, container) {
  // è°ƒç”¨ç»„ä»¶å‡½æ•°è·å– subtree
  const subtree = vnode.tag()  // è¿™é‡Œè·å–åˆ°ä¸Šé¢çš„è™šæ‹ŸDOMå¯¹è±¡
  
  // ç„¶åé€’å½’æ¸²æŸ“è¿™ä¸ª subtree
  renderer(subtree, container)
}
```

#### ä¸ºä»€ä¹ˆå« "subtree"ï¼Ÿ

1. **ç›¸å¯¹æ¦‚å¿µ**ï¼šç›¸å¯¹äºçˆ¶ç»„ä»¶æ¥è¯´ï¼Œå­ç»„ä»¶è¿”å›çš„è™šæ‹ŸDOMæ˜¯ä¸€ä¸ª**å­æ ‘**
2. **æ ‘å½¢ç»“æ„**ï¼šæ•´ä¸ªåº”ç”¨çš„è™šæ‹ŸDOMæ˜¯ä¸€æ£µå¤§æ ‘ï¼Œæ¯ä¸ªç»„ä»¶è¿”å›çš„æ˜¯å…¶ä¸­çš„ä¸€æ£µå­æ ‘
3. **é€’å½’åŸºç¡€**ï¼šæ­£æ˜¯è¿™ç§å­æ ‘ç»“æ„ï¼Œæ‰ä½¿å¾—é€’å½’æ¸²æŸ“æˆä¸ºå¯èƒ½

#### å®é™…æ¸²æŸ“ç¤ºä¾‹

```javascript
// çˆ¶ç»„ä»¶è¿”å›çš„è™šæ‹ŸDOM
const parentVNode = {
  tag: 'div',
  children: [
    { tag: 'h1', children: 'æ ‡é¢˜' },        // è¿™æ˜¯ subtree 1
    { tag: ChildComponent }                 // è¿™æ˜¯ subtree 2
  ]
}

// å½“æ¸²æŸ“å™¨å¤„ç† ChildComponent æ—¶ï¼š
// 1. è°ƒç”¨ ChildComponent() è·å– subtree
// 2. subtree = { tag: 'span', children: 'æˆ‘æ˜¯å­ç»„ä»¶' }
// 3. é€’å½’æ¸²æŸ“è¿™ä¸ª subtree

// æœ€ç»ˆå®Œæ•´çš„ DOM æ ‘ï¼š
<div>
  <h1>æ ‡é¢˜</h1>
  <span>æˆ‘æ˜¯å­ç»„ä»¶</span>
</div>
```

#### subtree åœ¨æ¸²æŸ“é“¾ä¸­çš„ä½œç”¨

```
renderer(ParentComponent) 
  â†’ mountComponent(ParentComponent)
    â†’ ParentComponent() è¿”å› subtree (çˆ¶ç»„ä»¶çš„è™šæ‹ŸDOM)
    â†’ renderer(subtree)  // é€’å½’æ¸²æŸ“çˆ¶ç»„ä»¶çš„ subtree
      â†’ mountElement(div)
        â†’ renderer(h1) â†’ mountElement(h1)     // å¤„ç†å­æ ‘1
        â†’ renderer(ChildComponent)           // å¤„ç†å­æ ‘2
          â†’ mountComponent(ChildComponent)
            â†’ ChildComponent() è¿”å› subtree (å­ç»„ä»¶çš„è™šæ‹ŸDOM)
            â†’ renderer(subtree) â†’ mountElement(span)
```

#### å…³é”®ç†è§£

- **subtree æ˜¯è¿æ¥ç»„ä»¶å’Œæ¸²æŸ“å™¨çš„æ¡¥æ¢**ï¼šç»„ä»¶å‡½æ•°è¿”å› subtreeï¼Œæ¸²æŸ“å™¨æ¥æ”¶ subtree
- **subtree ä¿æŒäº†è™šæ‹ŸDOMçš„ç»Ÿä¸€æ€§**ï¼šæ— è®ºæ˜¯æ™®é€šå…ƒç´ è¿˜æ˜¯ç»„ä»¶ï¼Œæœ€ç»ˆéƒ½è¡¨ç¤ºä¸ºè™šæ‹ŸDOM
- **subtree æ”¯æŒæ— é™åµŒå¥—**ï¼šä»»æ„æ·±åº¦çš„ç»„ä»¶åµŒå¥—éƒ½å¯ä»¥é€šè¿‡ subtree æœºåˆ¶å¤„ç†

**ç®€å•è¯´**ï¼š`subtree` å°±æ˜¯**ç»„ä»¶è¦æ¸²æŸ“çš„è™šæ‹ŸDOMå†…å®¹**ï¼Œå®ƒæ˜¯æ•´ä¸ªè™šæ‹ŸDOMæ ‘çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦é€’å½’æ¸²æŸ“æ‰èƒ½å˜æˆçœŸå®çš„DOMå…ƒç´ ã€‚

### ä»"ä¼šç”¨"åˆ°"ç†è§£åŸç†"çš„çªç ´

é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œæˆ‘å®Œæˆäº†å¯¹Vue 3åº•å±‚æœºåˆ¶çš„å®Œæ•´ç†è§£ï¼š

1. **ç»„ä»¶æœ¬è´¨**: ç»„ä»¶æ˜¯è¿”å›è™šæ‹ŸDOMçš„å‡½æ•°
2. **æ¸²æŸ“æœºåˆ¶**: é€šè¿‡ç±»å‹åˆ¤æ–­å’Œé€’å½’è°ƒç”¨å®ç°ç»Ÿä¸€æ¸²æŸ“
3. **ç¼–è¯‘è¿‡ç¨‹**: æ¨¡æ¿â†’æ¸²æŸ“å‡½æ•°â†’è™šæ‹ŸDOMâ†’çœŸå®DOM
4. **è®¾è®¡ç†å¿µ**: å£°æ˜å¼ç¼–ç¨‹ã€å…³æ³¨ç‚¹åˆ†ç¦»ã€è·¨å¹³å°èƒ½åŠ›

è¿™ä¸ªç†è§£è®©æˆ‘ä»"ä¼šç”¨Vue"æå‡åˆ°äº†"ç†è§£Vueè®¾è®¡åŸç†"çš„å±‚æ¬¡ï¼Œä¸ºåç»­çš„é«˜çº§ç‰¹æ€§å­¦ä¹ å’Œæ€§èƒ½ä¼˜åŒ–æ‰“ä¸‹äº†åšå®åŸºç¡€ã€‚

### ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘

1. **å“åº”å¼ç³»ç»Ÿ**: ç†è§£Vueå¦‚ä½•æ£€æµ‹æ•°æ®å˜åŒ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“
2. **ç¼–è¯‘å™¨ä¼˜åŒ–**: æ·±å…¥äº†è§£Vue 3çš„ç¼–è¯‘æ—¶ä¼˜åŒ–ç­–ç•¥
3. **æ€§èƒ½è°ƒä¼˜**: åŸºäºè¿™äº›ç†è§£è¿›è¡Œå®é™…çš„æ€§èƒ½ä¼˜åŒ–
4. **æºç é˜…è¯»**: ç›´æ¥é˜…è¯»Vue 3æºç ï¼ŒéªŒè¯è¿™äº›ç†è§£

---

*ä»Šå¤©å®Œæˆäº†å¯¹Vue 3è™šæ‹ŸDOMæ¸²æŸ“å™¨å’Œç¼–è¯‘å™¨æœºåˆ¶çš„å®Œæ•´ç†è§£ï¼Œä»å‰ç«¯æ¡†æ¶çš„ä½¿ç”¨è€…å‘ç†è§£è€…è½¬å˜ï¼Œè¿™æ˜¯æŠ€æœ¯æ·±åº¦çš„é‡è¦çªç ´ã€‚*