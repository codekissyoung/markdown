# JavaScriptä»£ç†æ¨¡å¼ï¼šä¼˜é›…çš„å›¾ç‰‡é¢„åŠ è½½å®ç°

## é—®é¢˜çš„èµ·æº

åœ¨ç½‘é¡µå¼€å‘ä¸­ï¼Œå›¾ç‰‡åŠ è½½æ˜¯ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ã€‚å½“å›¾ç‰‡è¾ƒå¤§æˆ–ç½‘ç»œè¾ƒæ…¢æ—¶ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ç©ºç™½åŒºåŸŸï¼Œä½“éªŒå¾ˆå·®ã€‚ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸ªç»å…¸çš„è§£å†³æ–¹æ¡ˆï¼š**ä»£ç†æ¨¡å¼çš„å›¾ç‰‡é¢„åŠ è½½**ã€‚

## æ ¸å¿ƒä»£ç è§£æ

æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªç»å…¸çš„ä»£ç†æ¨¡å¼å®ç°ï¼š

```javascript
// çœŸå®çš„å›¾ç‰‡å¯¹è±¡
var myImage = (function(){
    var imgNode = document.createElement('img');
    document.body.appendChild(imgNode);

    return {
        setSrc: function(src){
            imgNode.src = src;
        }
    }
})();

// ä»£ç†å¯¹è±¡
var proxyImage = (function(){
    var img = new Image;
    img.onload = function(){
        myImage.setSrc(this.src);
    }
    return {
        setSrc: function(src){
            myImage.setSrc('file:// /C:/Users/svenzeng/Desktop/loading.gif');
            img.src = src;
        }
    }
})();

// ä½¿ç”¨ä»£ç†
proxyImage.setSrc('http://imgcache.qq.com/music/photo/k/000GGDys0yA0Nk.jpg');
```

## é€å¥æ·±åº¦è§£æ

### ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆ›å»ºçœŸå®çš„å›¾ç‰‡å¯¹è±¡

```javascript
var myImage = (function(){
    var imgNode = document.createElement('img');    // åˆ›å»ºimgå…ƒç´ 
    document.body.appendChild(imgNode);             // æ·»åŠ åˆ°é¡µé¢
    return {
        setSrc: function(src){                     // æä¾›è®¾ç½®srcçš„æ–¹æ³•
            imgNode.src = src;                     // è®¾ç½®å›¾ç‰‡æº
        }
    }
})();
```

è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª**çœŸå®çš„å›¾ç‰‡å¯¹è±¡**ï¼Œå®ƒè´Ÿè´£ï¼š
- åœ¨é¡µé¢ä¸­åˆ›å»ºä¸€ä¸ª`<img>`å…ƒç´ 
- å°†è¿™ä¸ªå…ƒç´ æ·»åŠ åˆ°é¡µé¢ä¸­æ˜¾ç¤º
- æä¾›`setSrc`æ–¹æ³•æ¥è®¾ç½®å›¾ç‰‡æº

### ç¬¬äºŒéƒ¨åˆ†ï¼šåˆ›å»ºä»£ç†å¯¹è±¡

```javascript
var proxyImage = (function(){
    var img = new Image;                            // åˆ›å»ºå†…å­˜ä¸­çš„Imageå¯¹è±¡
    img.onload = function(){                        // å›¾ç‰‡åŠ è½½å®Œæˆäº‹ä»¶
        myImage.setSrc(this.src);                   // è®¾ç½®çœŸå®å›¾ç‰‡
    }
    return {
        setSrc: function(src){                     // ä»£ç†çš„setSrcæ–¹æ³•
            myImage.setSrc('loading.gif');          // å…ˆæ˜¾ç¤ºloadingå›¾
            img.src = src;                          // å¼€å§‹åŠ è½½çœŸå®å›¾ç‰‡
        }
    }
})();
```

ä»£ç†å¯¹è±¡çš„æ ¸å¿ƒä½œç”¨ï¼š
- **é¢„åŠ è½½**ï¼šä½¿ç”¨`new Image()`åœ¨å†…å­˜ä¸­åŠ è½½å›¾ç‰‡
- **çŠ¶æ€ç®¡ç†**ï¼šå…ˆæ˜¾ç¤ºloadingçŠ¶æ€ï¼Œå†æ˜¾ç¤ºçœŸå®å›¾ç‰‡
- **ç”¨æˆ·ä½“éªŒ**ï¼šé¿å…ç”¨æˆ·çœ‹åˆ°ç©ºç™½ç­‰å¾…

### å…³é”®ç‚¹ï¼š`this`çš„ç†è§£

```javascript
img.onload = function(){
    myImage.setSrc(this.src);  // è¿™é‡Œçš„thisæ˜¯ä»€ä¹ˆï¼Ÿ
}
```

**`this`æŒ‡å‘`img`å¯¹è±¡**ï¼å› ä¸ºï¼š
- `img.onload`æ˜¯`img`å¯¹è±¡çš„äº‹ä»¶å¤„ç†å™¨
- å½“å›¾ç‰‡åŠ è½½å®Œæˆæ—¶ï¼Œ`img`å¯¹è±¡è§¦å‘äº†`onload`äº‹ä»¶
- åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œ`this`æŒ‡å‘è§¦å‘äº‹ä»¶çš„å¯¹è±¡

æ‰€ä»¥`this.src`ç­‰ä»·äº`img.src`ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨åŠ è½½çš„å›¾ç‰‡URLã€‚

## æ‰§è¡Œæµç¨‹è¯¦è§£

### è°ƒç”¨`proxyImage.setSrc()`æ—¶ï¼š

1. **ç«‹å³æ˜¾ç¤ºloadingçŠ¶æ€**
   ```javascript
   myImage.setSrc('loading.gif');
   ```

2. **å¼€å§‹åå°åŠ è½½**
   ```javascript
   img.src = 'çœŸå®å›¾ç‰‡URL';  // è§¦å‘å¼‚æ­¥åŠ è½½
   ```

3. **å›¾ç‰‡åŠ è½½å®Œæˆå**
   ```javascript
   img.onload = function(){
       myImage.setSrc(this.src);  // æ›¿æ¢loadingå›¾
   }
   ```

### ç”¨æˆ·çœ‹åˆ°çš„æ•ˆæœï¼š
```
loading.gif â†’ çœŸå®å›¾ç‰‡
```

è€Œä¸æ˜¯ï¼š
```
ç©ºç™½ â†’ çœŸå®å›¾ç‰‡
```

## ä»£ç†æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³

### ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ï¼Ÿ

ä»£ç†æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š

- **çœŸå®å¯¹è±¡**ï¼š`myImage` - è´Ÿè´£åœ¨é¡µé¢ä¸­æ˜¾ç¤ºå›¾ç‰‡
- **ä»£ç†å¯¹è±¡**ï¼š`proxyImage` - è´Ÿè´£é¢„åŠ è½½å’ŒçŠ¶æ€ç®¡ç†

### ä»£ç†æ¨¡å¼çš„ä¼˜åŠ¿ï¼š

1. **èŒè´£åˆ†ç¦»**ï¼šæ˜¾ç¤ºå›¾ç‰‡å’Œé¢„åŠ è½½å›¾ç‰‡åˆ†å¼€å¤„ç†
2. **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›loadingçŠ¶æ€ï¼Œé¿å…ç©ºç™½ç­‰å¾…
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡é¡µé¢æ¸²æŸ“
4. **ä»£ç å¤ç”¨**ï¼šå¯ä»¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å›¾ç‰‡çš„åŠ è½½é€»è¾‘

## å®é™…åº”ç”¨åœºæ™¯

### 1. å›¾ç‰‡æ‡’åŠ è½½

```javascript
// ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œå½“å›¾ç‰‡è¿›å…¥è§†å£æ—¶å†åŠ è½½
function lazyLoadImages() {
    const images = document.querySelectorAll('img[data-src]');
    images.forEach(img => {
        if (isInViewport(img)) {
            const proxy = createImageProxy();
            proxy.setSrc(img.dataset.src);
        }
    });
}
```

### 2. å›¾ç‰‡é”™è¯¯å¤„ç†

```javascript
var proxyImage = (function(){
    var img = new Image;
    img.onload = function(){
        myImage.setSrc(this.src);
    }
    img.onerror = function(){
        myImage.setSrc('error.png');  // åŠ è½½å¤±è´¥æ˜¾ç¤ºé”™è¯¯å›¾ç‰‡
    }
    return {
        setSrc: function(src){
            myImage.setSrc('loading.gif');
            img.src = src;
        }
    }
})();
```

### 3. æ‰¹é‡å›¾ç‰‡ç®¡ç†

```javascript
var ImageManager = {
    proxies: [],
    createProxy: function(realImage) {
        // åˆ›å»ºä»£ç†é€»è¾‘
    },
    loadAll: function(imageUrls) {
        // æ‰¹é‡åŠ è½½é€»è¾‘
    }
};
```

## ç°ä»£å‰ç«¯ä¸­çš„æ›¿ä»£æ–¹æ¡ˆ

åœ¨React/Vueç­‰ç°ä»£æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ›´ä¼˜é›…çš„æ–¹å¼å®ç°ï¼š

### Reactå®ç°

```jsx
function LazyImage({ src, loadingSrc, errorSrc }) {
    const [currentSrc, setCurrentSrc] = useState(loadingSrc);
    const [status, setStatus] = useState('loading');
    
    useEffect(() => {
        const img = new Image();
        img.onload = () => {
            setCurrentSrc(src);
            setStatus('loaded');
        };
        img.onerror = () => {
            setCurrentSrc(errorSrc);
            setStatus('error');
        };
        img.src = src;
    }, [src]);
    
    return <img src={currentSrc} data-status={status} />;
}
```

### Vue3å®ç°

```vue
<template>
  <img :src="currentSrc" :class="status" />
</template>

<script setup>
import { ref, onMounted } from 'vue'

const props = defineProps(['src', 'loadingSrc', 'errorSrc'])
const currentSrc = ref(props.loadingSrc)
const status = ref('loading')

onMounted(() => {
  const img = new Image()
  img.onload = () => {
    currentSrc.value = props.src
    status.value = 'loaded'
  }
  img.onerror = () => {
    currentSrc.value = props.errorSrc
    status.value = 'error'
  }
  img.src = props.src
})
</script>
```

## æ€»ç»“

è¿™ä¸ªä»£ç†æ¨¡å¼çš„å›¾ç‰‡é¢„åŠ è½½ç¤ºä¾‹è™½ç„¶ç®€å•ï¼Œä½†åŒ…å«äº†**è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³**ï¼š

1. **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªå¯¹è±¡éƒ½æœ‰æ˜ç¡®çš„èŒè´£
2. **å¼€é—­åŸåˆ™**ï¼šå¯ä»¥é€šè¿‡æ‰©å±•ä»£ç†åŠŸèƒ½è€Œä¸ä¿®æ”¹åŸæœ‰ä»£ç 
3. **ä¾èµ–å€’ç½®åŸåˆ™**ï¼šé«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—çš„å…·ä½“å®ç°

### å…³é”®è¦ç‚¹ï¼š

- **`new Image()`** åˆ›å»ºå†…å­˜ä¸­çš„å›¾ç‰‡å¯¹è±¡ï¼Œç”¨äºé¢„åŠ è½½
- **`img.onload`** äº‹ä»¶åœ¨å›¾ç‰‡åŠ è½½å®Œæˆåè§¦å‘
- **`this.src`** ä¸­çš„`this`æŒ‡å‘è§¦å‘äº‹ä»¶çš„`img`å¯¹è±¡
- **ä»£ç†æ¨¡å¼** é€šè¿‡ä¸­é—´å±‚æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®

### å­¦ä¹ æ”¶è·ï¼š

1. ç†è§£JavaScriptä¸­çš„`this`æŒ‡å‘
2. æŒæ¡å›¾ç‰‡é¢„åŠ è½½çš„æŠ€æœ¯åŸç†
3. å­¦ä¹ ä»£ç†æ¨¡å¼çš„å®é™…åº”ç”¨
4. æå‡ç”¨æˆ·ä½“éªŒçš„è®¾è®¡æ€ç»´

è¿™ç§æ¨¡å¼è™½ç„¶ç®€å•ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­éå¸¸å®ç”¨ã€‚ç†è§£äº†è¿™ä¸ªåŸç†ï¼Œä½ å°±å¯ä»¥åœ¨å„ç§å‰ç«¯åœºæ™¯ä¸­åº”ç”¨ä»£ç†æ¨¡å¼ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

---

*ğŸ“ ç›¸å…³æ–‡ä»¶ï¼š`/Users/link/workspace/markdown/å‰ç«¯/ä»£ç†æ¨¡å¼å›¾ç‰‡é¢„åŠ è½½.md`*  
*ğŸ·ï¸ æ ‡ç­¾ï¼šJavaScriptã€ä»£ç†æ¨¡å¼ã€å‰ç«¯ä¼˜åŒ–ã€ç”¨æˆ·ä½“éªŒ*  
*ğŸ“… åˆ›å»ºæ—¶é—´ï¼š2025-09-25*