| 数据大小 | 压测时长 | 并发链接 | 单次插入 |  IO  | CPU  |  TPS  |
| :------: | :------: | :------: | :------: | :--: | :--: | :---: |
|  1 byte  |  2218s   |   533    |   1条    | 1.7M | 60%  | 15003 |
|   1 kb   |   882s   |   533    |   1条    | 15MB | 55%  | 13839 |
|  20 kb   |   688s   |   533    |   1条    | 10MB | 99%  | 1020  |
|  20 kb   |  4430s   |    10    |   1条    | 12MB | 20%  |  684  |
|  100 kb  |   986s   |    10    |   1条    | 25MB | 36%  |  286  |


### 新增数据库字段，字段缓存未更新

后果：数据记录写入成功，但该字段会被过滤掉

### 删除数据库字段，字段缓存未更新

后果：数据记录写入失败，Model报错

分两种情况，假如：

删除数据库字段，`in_array( $key, $fields)`　返回 false 表示失败，表示代码中插入的数据不在数据库中.

![image-20201229165717196](/home/link/.config/Typora/typora-user-images/image-20201229165717196.png)



![image-20201229165759428](/home/link/.config/Typora/typora-user-images/image-20201229165759428.png)



## MQ 风险评估

### 负载情况

- CPU : 10% ~15% / 4核

- 内存 : 2.06G / 15.7G

- 消息峰值 : 400条 / 5000条 (2核8G 压测值)

- 日均消息数 : 550 万条

### 监控情况

- MQ Server 链接失败告警

- MQ 连接数超过 1000 告警

- 消息堆积数超过阈值告警
- 机器 CPU 内存 磁盘有阿里云告警

### 保活情况

由 Docker Daemon 负责 MQ Server 的保活

以目前负载和测试机器数据保守估计，可以抗住目前 10倍 的消息数．日常可以接收到少量的消息堆积告警，业务可以适当新增消费者进程数量．

























